{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "select-search",
  "title": "Select Search",
  "description": "A searchable select dropdown component.",
  "registryDependencies": ["button", "popover", "command", "separator"],
  "files": [
    {
      "path": "registry/helisa/ui/select-search.tsx",
      "content": "\"use client\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Command,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandItem,\r\n  CommandList,\r\n} from \"@/components/ui/command\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\n\r\nimport { ChevronDownIcon } from \"lucide-react\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\ntype Props<T> = {\r\n  data?: T[];\r\n  getOptionValue: (item: T) => string;\r\n  getOptionLabel: (item: T) => string;\r\n\r\n  value?: string | null;\r\n  onChange?: (value: string | null, item: T | null) => void;\r\n\r\n  // Búsqueda\r\n  searchValue?: string;\r\n  onSearchChange?: (value: string) => void;\r\n  isLoading?: boolean;\r\n  minLength?: number;\r\n\r\n  // Comportamiento\r\n  clearOnSelect?: boolean;\r\n\r\n  // UI\r\n  placeholder?: string;\r\n  searchPlaceholder?: string;\r\n\r\n  disabled?: boolean;\r\n  testId?: string;\r\n};\r\n\r\nfunction SelectSearch<T>({\r\n  data = [],\r\n  getOptionValue,\r\n  getOptionLabel,\r\n  value,\r\n  onChange,\r\n  searchValue,\r\n  onSearchChange,\r\n  isLoading = false,\r\n  minLength = 2,\r\n  clearOnSelect = false,\r\n  placeholder = \"Seleccione una opción\",\r\n  searchPlaceholder = \"Buscar...\",\r\n  disabled,\r\n  testId,\r\n}: Props<T>) {\r\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\r\n  const [selectedLabel, setSelectedLabel] = useState<string | null>(null);\r\n\r\n  const [internalSearch, setInternalSearch] = useState(\"\");\r\n  const search = searchValue ?? internalSearch;\r\n\r\n  const handleSelect = (newValue: string | null) => {\r\n    const selectedItem =\r\n      data.find((item) => getOptionValue(item) === newValue) ?? null;\r\n\r\n    if (!clearOnSelect) {\r\n      setSelectedLabel(selectedItem ? getOptionLabel(selectedItem) : null);\r\n    }\r\n\r\n    onChange?.(newValue, selectedItem);\r\n    setInternalSearch(\"\");\r\n    onSearchChange?.(\"\");\r\n\r\n    setIsPopoverOpen(false);\r\n  };\r\n\r\n  const handleClear = () => {\r\n    handleSelect(null);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (clearOnSelect) {\r\n      setSelectedLabel(null);\r\n      return;\r\n    }\r\n\r\n    if (!value) {\r\n      setSelectedLabel(null);\r\n      return;\r\n    }\r\n\r\n    const item = data.find((item) => getOptionValue(item) === value);\r\n    if (item) {\r\n      setSelectedLabel(getOptionLabel(item));\r\n    }\r\n  }, [value, data, clearOnSelect, getOptionLabel, getOptionValue]);\r\n\r\n  return (\r\n    <>\r\n      <Popover open={isPopoverOpen} onOpenChange={setIsPopoverOpen}>\r\n        <PopoverTrigger asChild>\r\n          <Button\r\n            variant=\"outline\"\r\n            role=\"combobox\"\r\n            aria-expanded={isPopoverOpen}\r\n            className=\"w-full justify-between\"\r\n            disabled={disabled}\r\n            data-test-id={testId}\r\n          >\r\n            <span title={selectedLabel || undefined}>\r\n              {selectedLabel || (\r\n                <span className=\"text-muted-foreground\">{placeholder}</span>\r\n              )}\r\n            </span>\r\n            <ChevronDownIcon className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n          </Button>\r\n        </PopoverTrigger>\r\n\r\n        <PopoverContent\r\n          className=\"w-[var(--radix-popover-trigger-width)] p-0\"\r\n          align=\"start\"\r\n        >\r\n          <Command shouldFilter={false}>\r\n            <CommandInput\r\n              placeholder={searchPlaceholder}\r\n              value={search}\r\n              onValueChange={(value) => {\r\n                setInternalSearch(value);\r\n                onSearchChange?.(value);\r\n              }}\r\n            />\r\n            <CommandList className=\"max-h-60 overflow-y-auto\">\r\n              {isLoading && <CommandEmpty>Buscando...</CommandEmpty>}\r\n\r\n              {!isLoading && search.length < minLength && (\r\n                <CommandEmpty>\r\n                  Escribe al menos {minLength} caracteres\r\n                </CommandEmpty>\r\n              )}\r\n\r\n              {!isLoading && !data.length && search.length >= minLength && (\r\n                <CommandEmpty>Sin resultados</CommandEmpty>\r\n              )}\r\n\r\n              {!isLoading && data.length > 0 && (\r\n                <>\r\n                  <CommandGroup heading=\"Resultados\">\r\n                    {data.map((item) => (\r\n                      <CommandItem\r\n                        key={getOptionValue(item)}\r\n                        onSelect={() => handleSelect(getOptionValue(item))}\r\n                        className=\"pl-3\"\r\n                      >\r\n                        {getOptionLabel(item)}\r\n                      </CommandItem>\r\n                    ))}\r\n                  </CommandGroup>\r\n                </>\r\n              )}\r\n\r\n              {!clearOnSelect && selectedLabel && data.length > 0 && (\r\n                <Separator />\r\n              )}\r\n\r\n              {!clearOnSelect && selectedLabel && (\r\n                <CommandGroup>\r\n                  <CommandItem\r\n                    onSelect={handleClear}\r\n                    className=\"justify-center cursor-pointer\"\r\n                  >\r\n                    Limpiar selección\r\n                  </CommandItem>\r\n                </CommandGroup>\r\n              )}\r\n            </CommandList>\r\n          </Command>\r\n        </PopoverContent>\r\n      </Popover>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default SelectSearch;\r\n",
      "type": "registry:ui",
      "target": "components/helisa/ui/select-search.tsx"
    }
  ],
  "type": "registry:ui"
}
