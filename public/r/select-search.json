{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "select-search",
  "type": "registry:ui",
  "title": "Select Search",
  "description": "A searchable select dropdown component.",
  "registryDependencies": ["button", "popover", "command", "separator"],
  "files": [
    {
      "path": "registry/helisa/ui/select-search.tsx",
      "content": "\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Separator } from \"@/components/ui/separator\";\n\nimport { ChevronDownIcon } from \"lucide-react\";\nimport { useEffect, useState } from \"react\";\n\ntype Props<T> = {\n  data?: T[];\n  getOptionValue: (item: T) => string;\n  getOptionLabel: (item: T) => string;\n\n  value?: string | null;\n  onChange?: (value: string | null, item: T | null) => void;\n\n  // Búsqueda\n  searchValue?: string;\n  onSearchChange?: (value: string) => void;\n  isLoading?: boolean;\n  minLength?: number;\n\n  // Comportamiento\n  clearOnSelect?: boolean;\n\n  // UI\n  placeholder?: string;\n  searchPlaceholder?: string;\n\n  disabled?: boolean;\n  testId?: string;\n};\n\nfunction SelectSearch<T>({\n  data = [],\n  getOptionValue,\n  getOptionLabel,\n  value,\n  onChange,\n  searchValue,\n  onSearchChange,\n  isLoading = false,\n  minLength = 2,\n  clearOnSelect = false,\n  placeholder = \"Seleccione una opción\",\n  searchPlaceholder = \"Buscar...\",\n  disabled,\n  testId,\n}: Props<T>) {\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n  const [selectedLabel, setSelectedLabel] = useState<string | null>(null);\n\n  const [internalSearch, setInternalSearch] = useState(\"\");\n  const search = searchValue ?? internalSearch;\n\n  const handleSelect = (newValue: string | null) => {\n    const selectedItem =\n      data.find((item) => getOptionValue(item) === newValue) ?? null;\n\n    if (!clearOnSelect) {\n      setSelectedLabel(selectedItem ? getOptionLabel(selectedItem) : null);\n    }\n\n    onChange?.(newValue, selectedItem);\n    setInternalSearch(\"\");\n    onSearchChange?.(\"\");\n\n    setIsPopoverOpen(false);\n  };\n\n  const handleClear = () => {\n    handleSelect(null);\n  };\n\n  useEffect(() => {\n    if (clearOnSelect) {\n      setSelectedLabel(null);\n      return;\n    }\n\n    if (!value) {\n      setSelectedLabel(null);\n      return;\n    }\n\n    const item = data.find((item) => getOptionValue(item) === value);\n    if (item) {\n      setSelectedLabel(getOptionLabel(item));\n    }\n  }, [value, data, clearOnSelect, getOptionLabel, getOptionValue]);\n\n  return (\n    <>\n      <Popover open={isPopoverOpen} onOpenChange={setIsPopoverOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            role=\"combobox\"\n            aria-expanded={isPopoverOpen}\n            className=\"w-full justify-between\"\n            disabled={disabled}\n            data-test-id={testId}\n          >\n            <span title={selectedLabel || undefined}>\n              {selectedLabel || (\n                <span className=\"text-muted-foreground\">{placeholder}</span>\n              )}\n            </span>\n            <ChevronDownIcon className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n          </Button>\n        </PopoverTrigger>\n\n        <PopoverContent\n          className=\"w-[var(--radix-popover-trigger-width)] p-0\"\n          align=\"start\"\n        >\n          <Command shouldFilter={false}>\n            <CommandInput\n              placeholder={searchPlaceholder}\n              value={search}\n              onValueChange={(value) => {\n                setInternalSearch(value);\n                onSearchChange?.(value);\n              }}\n            />\n            <CommandList className=\"max-h-60 overflow-y-hidden\">\n              {isLoading && <CommandEmpty>Buscando...</CommandEmpty>}\n\n              {!isLoading && search.length < minLength && (\n                <CommandEmpty>\n                  Escribe al menos {minLength} caracteres\n                </CommandEmpty>\n              )}\n\n              {!isLoading && !data.length && search.length >= minLength && (\n                <CommandEmpty>Sin resultados</CommandEmpty>\n              )}\n\n              {!isLoading && data.length > 0 && (\n                <>\n                  <CommandGroup heading=\"Resultados\">\n                    {data.map((item) => (\n                      <CommandItem\n                        key={getOptionValue(item)}\n                        onSelect={() => handleSelect(getOptionValue(item))}\n                        className=\"pl-3\"\n                      >\n                        {getOptionLabel(item)}\n                      </CommandItem>\n                    ))}\n                  </CommandGroup>\n                </>\n              )}\n\n              {!clearOnSelect && selectedLabel && data.length > 0 && (\n                <Separator />\n              )}\n\n              {!clearOnSelect && selectedLabel && (\n                <CommandGroup>\n                  <CommandItem\n                    onSelect={handleClear}\n                    className=\"justify-center cursor-pointer\"\n                  >\n                    Limpiar selección\n                  </CommandItem>\n                </CommandGroup>\n              )}\n            </CommandList>\n          </Command>\n        </PopoverContent>\n      </Popover>\n    </>\n  );\n}\n\nexport default SelectSearch;\n",
      "type": "registry:ui",
      "target": "components/helisa/ui/select-search.tsx"
    }
  ]
}
